/**
 * findAndReplaceDOMText v 0.4.0
 * @author James Padolsey http://james.padolsey.com
 * @license http://unlicense.org/UNLICENSE
 * https://padolsey.github.io/findAndReplaceDOMText/src/findAndReplaceDOMText.js
 *
 * Matches the text of a DOM node against a regular expression
 * and replaces each match (or node-separated portions of the match)
 * in the specified element.
 */
window.findAndReplaceDOMText=function(){function e(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function n(){return t.apply(null,arguments)||r.apply(null,arguments)}function t(e,t,i,d,o){if(t&&!t.nodeType&&arguments.length<=2)return!1;var a="function"==typeof i;a&&(i=function(e){return function(n,t){return e(n.text,t.startIndex)}}(i));var s=r(t,{find:e,wrap:a?null:i,replace:a?i:"$"+(d||"&"),prepMatch:function(e,n){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(d>0){var t=e[d];e.index+=e[0].indexOf(t),e[0]=t}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=n,e},filterElements:o});return n.revert=function(){return s.revert()},!0}function r(e,n){return new i(e,n)}function i(e,n){n.portionMode=n.portionMode||d,this.node=e,this.options=n,this.prepMatch=n.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var d="retain",o="first",a=document;({}).toString;return n.Finder=i,i.prototype={search:function(){var n,t=0,r=this.options.find,i=this.getAggregateText(),d=[];if(r="string"==typeof r?RegExp(e(r),"g"):r,r.global)for(;n=r.exec(i);)d.push(this.prepMatch(n,t++));else(n=i.match(r))&&d.push(this.prepMatch(n,0));return d},prepMatch:function(e,n){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=n,e},getAggregateText:function(){function e(t){if(3===t.nodeType)return t.data;if(n&&!n(t))return"";var r="";if(t=t.firstChild)do r+=e(t);while(t=t.nextSibling);return r}var n=this.options.filterElements;return e(this.node)},processMatches:function(){var e,n,t,r=this.matches,i=this.node,d=this.options.filterElements,o=[],a=i,s=r.shift(),h=0,p=0,c=0;e:for(;;){if(3===a.nodeType&&(!n&&a.length+h>=s.endIndex?n={node:a,index:c++,text:a.data.substring(s.startIndex-h,s.endIndex-h),indexInMatch:h-s.startIndex,indexInNode:s.startIndex-h,endIndexInNode:s.endIndex-h,isEnd:!0}:e&&o.push({node:a,index:c++,text:a.data,indexInMatch:h-s.startIndex,indexInNode:0}),!e&&a.length+h>s.startIndex&&(e={node:a,index:c++,indexInMatch:0,indexInNode:s.startIndex-h,endIndexInNode:s.endIndex-h,text:a.data.substring(s.startIndex-h,s.endIndex-h)}),h+=a.data.length),t=1===a.nodeType&&d&&!d(a),e&&n){if(a=this.replaceMatch(s,e,o,n),h-=n.node.data.length-n.endIndexInNode,e=null,n=null,o=[],s=r.shift(),c=0,p++,!s)break}else if(!t&&(a.firstChild||a.nextSibling)){a=a.firstChild||a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if(a.parentNode===i)break e;a=a.parentNode}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,n,t,r){var i=this.options.portionMode;return i===o&&n.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,function(e,n){var r;switch(n){case"&":r=t[0];break;case"`":r=t.input.substring(0,t.startIndex);break;case"'":r=t.input.substring(t.endIndex);break;default:r=t[+n]}return r}),i===o?e:n.isEnd?e.substring(n.indexInMatch):e.substring(n.indexInMatch,n.indexInMatch+n.text.length))},getPortionReplacementNode:function(e,n,t){var r=this.options.replace||"$&",i=this.options.wrap;if(i&&i.nodeType){var d=a.createElement("div");d.innerHTML=i.outerHTML||(new XMLSerializer).serializeToString(i),i=d.firstChild}if("function"==typeof r)return r=r(e,n,t),r&&r.nodeType?r:a.createTextNode(String(r));var o="string"==typeof i?a.createElement(i):i;return r=a.createTextNode(this.prepareReplacementString(r,e,n,t)),o?(o.appendChild(r),o):r},replaceMatch:function(e,n,t,r){var i,d,o=n.node,s=r.node;if(o===s){var h=o;n.indexInNode>0&&(i=a.createTextNode(h.data.substring(0,n.indexInNode)),h.parentNode.insertBefore(i,h));var p=this.getPortionReplacementNode(r,e);return h.parentNode.insertBefore(p,h),r.endIndexInNode<h.length&&(d=a.createTextNode(h.data.substring(r.endIndexInNode)),h.parentNode.insertBefore(d,h)),h.parentNode.removeChild(h),this.reverts.push(function(){i===p.previousSibling&&i.parentNode.removeChild(i),d===p.nextSibling&&d.parentNode.removeChild(d),p.parentNode.replaceChild(h,p)}),p}i=a.createTextNode(o.data.substring(0,n.indexInNode)),d=a.createTextNode(s.data.substring(r.endIndexInNode));for(var c=this.getPortionReplacementNode(n,e),l=[],u=0,f=t.length;f>u;++u){var x=t[u],g=this.getPortionReplacementNode(x,e);x.node.parentNode.replaceChild(g,x.node),this.reverts.push(function(e,n){return function(){n.parentNode.replaceChild(e.node,n)}}(x,g)),l.push(g)}var I=this.getPortionReplacementNode(r,e);return o.parentNode.insertBefore(i,o),o.parentNode.insertBefore(c,o),o.parentNode.removeChild(o),s.parentNode.insertBefore(I,s),s.parentNode.insertBefore(d,s),s.parentNode.removeChild(s),this.reverts.push(function(){i.parentNode.removeChild(i),c.parentNode.replaceChild(o,c),d.parentNode.removeChild(d),I.parentNode.replaceChild(s,I)}),I}},n}();

var github_repo = '{{ cookiecutter.github_username }}/{{ cookiecutter.github_repository }}';

findAndReplaceDOMText(document.querySelector('[role="main"]'), {
  find: /#(\d+)/g,
  replace: function(portion, match){
    var el = document.createElement("a");
    el.setAttribute('href', 'http://github.com/'+ github_repo +'/issues/'+ match[1]);
    el.setAttribute('target', '_blank');
    el.innerHTML = portion.text;
    return el;
    }
});
